# Quarantine Policy Configuration
# ================================
# This file defines quarantined tests with strict governance.
# CI enforces: expiry dates, issue IDs, and prevents quarantine growth.
#
# Rules:
# 1. All entries MUST have: issue_id, expiry_date, owner, reason
# 2. Expiry date max 30 days from quarantine date
# 3. CI fails if today > expiry_date
# 4. Quarantine count must not increase without explicit policy update

version: "1.0"
last_updated: "2026-02-21"

# Global settings
settings:
  max_quarantine_days: 30
  enforce_expiry: true
  block_on_expiry: true

# Quarantine entries
# NOTE: As of 2026-02-21 all formerly-skipped E2E tests have been converted
# from pytest.mark.skip to pytest.mark.xfail(strict=False).  They now RUN and
# REPORT but do not BLOCK CI.  Entries below are kept for tracking until the
# root causes are fully resolved.
quarantines:
  # Phase 3/4 incomplete features — now xfail (tests run, don't block)
  - id: GOVPLAT-001
    description: "Phase 3/4 endpoint tests - features incomplete (xfail)"
    expiry_date: "2026-03-23"
    owner: "platform-team"
    reason: "Phase 3 (Workflow Center) and Phase 4 (Compliance Automation) not implemented"
    marker: "phase34"
    status: "xfail"
    files:
      - tests/smoke/test_phase3_phase4_smoke.py
      - tests/e2e/test_workflows.py
      - tests/e2e/test_compliance_automation.py
    resolution_plan: "Complete Phase 3/4 implementation; tests will auto-promote when passing"

  # E2E API contract mismatch — now xfail (tests run, don't block)
  - id: GOVPLAT-002
    description: "E2E tests with API contract mismatch (xfail)"
    expiry_date: "2026-03-23"
    owner: "platform-team"
    reason: "Tests expect endpoints that return 404 or have different contracts"
    marker: "api_contract_mismatch"
    status: "xfail"
    files:
      - tests/e2e/test_portal_e2e.py
      - tests/e2e/test_enterprise_e2e.py
      - tests/e2e/test_full_workflow.py
    resolution_plan: "Audit API contracts and align tests with implementations; tests will auto-promote when passing"

  # AsyncSession fixture alignment — now xfail (tests run, don't block)
  - id: GOVPLAT-003
    description: "Planet Mark / UVDB AsyncSession fixture mismatch (xfail)"
    expiry_date: "2026-03-23"
    owner: "platform-team"
    reason: "Backend routes use AsyncSession.query which is not compatible with test fixtures"
    marker: "async_session"
    status: "xfail"
    files:
      - tests/e2e/test_planetmark_uvdb_e2e.py
    resolution_plan: "Align AsyncSession fixtures; tests will auto-promote when passing"

# Metrics tracking
metrics:
  baseline_quarantine_count: 3
  baseline_xfail_count: 7
  max_allowed_quarantine_count: 3
  last_audit_date: "2026-02-21"
  notes: "All 6 formerly-quarantined E2E files converted skip->xfail; 0 tests skipped, ~185 tests now xfail"

# Active test suites (must pass)
active_suites:
  - tests/unit/
  - tests/integration/
  - tests/smoke/test_enterprise_smoke.py
  - tests/e2e/

# Quarantine Policy Configuration
# ================================
# This file defines quarantined tests with strict governance.
# CI enforces: expiry dates, issue IDs, and prevents quarantine growth.
#
# Rules:
# 1. All entries MUST have: issue_id, expiry_date, owner, reason
# 2. Expiry date max 30 days from quarantine date
# 3. CI fails if today > expiry_date
# 4. Quarantine count must not increase without explicit policy update

version: "1.0"
last_updated: "2026-01-21"

# Global settings
settings:
  max_quarantine_days: 30
  enforce_expiry: true
  block_on_expiry: true

# Quarantine entries
quarantines:
  # Phase 3/4 incomplete features
  - id: GOVPLAT-001
    description: "Phase 3/4 endpoint tests - features incomplete"
    expiry_date: "2026-02-21"
    owner: "platform-team"
    reason: "Phase 3 (Workflow Center) and Phase 4 (Compliance Automation) not implemented"
    marker: "phase34"
    files:
      - tests/smoke/test_phase3_phase4_smoke.py
      - tests/e2e/test_workflows.py
      - tests/e2e/test_compliance_automation.py
    resolution_plan: "Complete Phase 3/4 implementation or remove tests"

  # E2E API contract mismatch
  - id: GOVPLAT-002
    description: "E2E tests with API contract mismatch"
    expiry_date: "2026-02-21"
    owner: "platform-team"
    reason: "Tests expect endpoints that return 404 or have different contracts"
    marker: "api_contract_mismatch"
    files:
      - tests/e2e/test_portal_e2e.py
      - tests/e2e/test_enterprise_e2e.py
      - tests/e2e/test_full_workflow.py
    resolution_plan: "Audit API contracts and align tests with implementations"

  # Async event loop conflict with DB pool
  - id: GOVPLAT-003
    description: "Planet Mark/UVDB contract tests - async event loop conflict"
    expiry_date: "2026-02-21"
    owner: "platform-team"
    reason: "httpx.AsyncClient creates separate event loop from app's DB pool"
    marker: "async_loop_conflict"
    files:
      - tests/integration/test_planet_mark_uvdb_contracts.py
    resolution_plan: "Create async_client fixture that initializes app in test loop"

  # E2E async event loop conflict
  - id: GOVPLAT-004
    description: "Planet Mark/UVDB E2E tests - async event loop conflict"
    expiry_date: "2026-02-21"
    owner: "platform-team"
    reason: "Same async loop conflict as integration tests"
    marker: "async_loop_conflict"
    files:
      - tests/e2e/test_planet_mark_uvdb_e2e.py
    resolution_plan: "Create async_client fixture that initializes app in test loop"

  # Sync TestClient with async app - event loop conflict
  - id: GOVPLAT-005
    description: "Planet Mark/UVDB sync TestClient tests - async loop conflict"
    expiry_date: "2026-02-21"
    owner: "platform-team"
    reason: "Even sync TestClient causes async loop issues with app's asyncpg pool"
    marker: "async_loop_conflict"
    files:
      - tests/e2e/test_planetmark_uvdb_e2e.py
    resolution_plan: "Create async_client fixture or use session-scoped event loop"

# Metrics tracking
metrics:
  baseline_quarantine_count: 9
  max_allowed_quarantine_count: 9
  last_audit_date: "2026-01-28"
  # Wave 1 changes:
  # - Deleted empty stub: tests/integration/test_planetmark_uvdb_api.py (was untracked)
  # - Added GOVPLAT-005: tests/e2e/test_planetmark_uvdb_e2e.py (was untracked)
  # Net change: +1 tracked file (previously untracked now governed)

# Active test suites (must pass)
active_suites:
  - tests/unit/
  - tests/integration/
  - tests/smoke/test_enterprise_smoke.py

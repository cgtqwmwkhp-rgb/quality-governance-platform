{
  "$schema": "./environment_endpoints.schema.json",
  "_comment": "Single source of truth for environment API endpoints. Updated by deploy workflows.",
  "_last_updated": "2026-01-30T23:05:00Z",
  "_updated_by": "config-drift-elimination",
  "_platform": "Azure Container Apps (ACA)",
  
  "environments": {
    "staging": {
      "platform": "azure-container-apps",
      "container_app_name": "qgp-staging",
      "container_environment": "qgp-staging-env",
      "region": "uksouth",
      "api_base_url": "https://qgp-staging.ashymushroom-85447e68.uksouth.azurecontainerapps.io",
      "swa_url": "https://purple-water-03205fa03-staging.uksouth.azurestaticapps.net",
      "health_endpoints": {
        "health": "/healthz",
        "ready": "/readyz",
        "live": "/health"
      },
      "api_version": "v1",
      "deployed": true
    },
    "production": {
      "platform": "azure-app-service",
      "_note": "Production ACA not yet provisioned - using App Service",
      "container_app_name": null,
      "container_environment": null,
      "region": "uksouth",
      "api_base_url": "https://app-qgp-prod.azurewebsites.net",
      "swa_url": "https://purple-water-03205fa03.uksouth.azurestaticapps.net",
      "health_endpoints": {
        "health": "/healthz",
        "ready": "/readyz",
        "live": "/health"
      },
      "api_version": "v1",
      "deployed": true
    }
  },
  
  "contract_probe": {
    "timeout_seconds": 30,
    "min_endpoints_required": 6,
    "endpoints": {
      "identity": {
        "path": "/api/v1/meta/version",
        "method": "GET",
        "auth_required": false,
        "expected_status": 200,
        "description": "API version/identity endpoint"
      },
      "healthz": {
        "path": "/healthz",
        "method": "GET",
        "auth_required": false,
        "expected_status": 200,
        "description": "Kubernetes-style health check"
      },
      "readyz": {
        "path": "/readyz",
        "method": "GET",
        "auth_required": false,
        "expected_status": 200,
        "description": "Kubernetes-style readiness check"
      },
      "incidents": {
        "path": "/api/v1/incidents/",
        "method": "GET",
        "auth_required": true,
        "expected_status_without_auth": [401, 403],
        "expected_status_with_auth": 200,
        "paginated": true,
        "required_response_keys": ["items", "total", "page", "page_size"],
        "description": "Incidents list with auth enforcement"
      },
      "complaints": {
        "path": "/api/v1/complaints/",
        "method": "GET",
        "auth_required": true,
        "expected_status_without_auth": [401, 403],
        "expected_status_with_auth": 200,
        "paginated": true,
        "required_response_keys": ["items", "total", "page", "page_size"],
        "description": "Complaints list with auth enforcement"
      },
      "rtas": {
        "path": "/api/v1/rtas/",
        "method": "GET",
        "auth_required": true,
        "expected_status_without_auth": [401, 403],
        "expected_status_with_auth": 200,
        "paginated": true,
        "required_response_keys": ["items", "total", "page", "page_size"],
        "description": "RTAs list with auth enforcement"
      }
    },
    "enforcement": {
      "post_deploy_required": true,
      "nightly_verification": true,
      "consecutive_failures_for_incident": 2
    }
  }
}

[project]
name = "quality-governance-platform"
version = "1.0.0"
description = "Enterprise-grade Quality Governance (IMS) Platform for ISO compliance management"
readme = "README.md"
requires-python = ">=3.11"
license = {text = "Proprietary"}
authors = [
    {name = "Quality Governance Team"}
]
keywords = ["iso", "compliance", "governance", "audit", "quality"]

[tool.black]
line-length = 120
target-version = ['py311']
include = '\.pyi?$'
exclude = '''
/(
    \.git
    | \.hg
    | \.mypy_cache
    | \.tox
    | \.venv
    | _build
    | buck-out
    | build
    | dist
    | alembic/versions
)/
'''

[tool.isort]
profile = "black"
line_length = 120
skip = [".git", ".venv", "alembic/versions"]
known_first_party = ["src"]

[tool.mypy]
python_version = "3.11"
ignore_missing_imports = true
# Re-enable basic warnings
warn_unused_configs = true
# Skip test files (tested separately)
exclude = ["alembic/versions", "tests"]

# Per-module overrides for pre-existing issues
# Each module with type issues is explicitly listed with specific ignores
# This prevents masking new errors while allowing known issues

[[tool.mypy.overrides]]
module = "src.domain.services.ai_predictive_service"
# GOVPLAT-004: Incident model attribute references
disable_error_code = ["attr-defined", "arg-type", "return-value", "union-attr"]

[[tool.mypy.overrides]]
module = "src.domain.services.ai_audit_service"
# GOVPLAT-004: AuditFinding model attribute references
disable_error_code = ["attr-defined", "arg-type", "union-attr", "return-value"]

[[tool.mypy.overrides]]
module = "src.domain.services.copilot_service"
# GOVPLAT-004: Copilot service return type issues
disable_error_code = ["return-value"]

[[tool.mypy.overrides]]
module = "src.domain.services.ai_models"
# GOVPLAT-004: AI model type issues
disable_error_code = ["no-any-return", "attr-defined"]

[[tool.mypy.overrides]]
module = "src.domain.services.audit_log_service"
# GOVPLAT-004: SQLAlchemy Row type issues
disable_error_code = ["var-annotated", "arg-type", "return-value"]

[[tool.mypy.overrides]]
module = "src.domain.services.abac_service"
# GOVPLAT-004: ABAC type issues
disable_error_code = ["no-any-return", "return-value", "assignment"]

[[tool.mypy.overrides]]
module = "src.domain.services.signature_service"
# GOVPLAT-004: Signature service type issues
disable_error_code = ["no-any-return", "operator", "return-value"]

[[tool.mypy.overrides]]
module = "src.domain.services.collaboration_service"
# GOVPLAT-004: Collaboration service type issues
disable_error_code = ["no-any-return", "return-value"]

[[tool.mypy.overrides]]
module = "src.domain.services.tenant_service"
# GOVPLAT-004: Tenant service type issues
disable_error_code = ["no-any-return", "return-value", "operator"]

[[tool.mypy.overrides]]
module = "src.services.auditor_competence"
# GOVPLAT-004: Type assignment issues
disable_error_code = ["assignment", "operator"]

[[tool.mypy.overrides]]
module = "src.services.policy_acknowledgment"
# GOVPLAT-004: Return type issues
disable_error_code = ["return-value"]

[[tool.mypy.overrides]]
module = "src.infrastructure.cache.redis_cache"
# GOVPLAT-004: Cache decorator type issues
disable_error_code = ["misc", "attr-defined", "return-value", "assignment"]

[[tool.mypy.overrides]]
module = "src.infrastructure.monitoring.azure_monitor"
# GOVPLAT-004: Azure monitor type issues
disable_error_code = ["assignment"]

[[tool.mypy.overrides]]
module = "src.api.routes.uvdb"
# GOVPLAT-004: UVDB route type issues
disable_error_code = ["arg-type", "attr-defined", "assignment", "misc"]

[[tool.mypy.overrides]]
module = "src.api.routes.planet_mark"
# GOVPLAT-004: Planet mark route type issues
disable_error_code = ["operator", "assignment", "arg-type", "return-value", "misc", "attr-defined"]

[[tool.mypy.overrides]]
module = "src.api.routes.iso27001"
# GOVPLAT-004: ISO 27001 route type issues
disable_error_code = ["operator", "call-overload"]

[[tool.mypy.overrides]]
module = "src.api.routes.document_control"
# GOVPLAT-004: Document control route type issues
disable_error_code = ["union-attr", "attr-defined"]

[[tool.mypy.overrides]]
module = "src.api.routes.risk_register"
# GOVPLAT-004: Risk register route type issues
disable_error_code = ["attr-defined"]

[[tool.mypy.overrides]]
module = "src.services.workflow_engine"
# GOVPLAT-004: Workflow engine type issues
disable_error_code = ["assignment", "var-annotated", "arg-type", "operator"]

[[tool.mypy.overrides]]
module = "src.services.risk_scoring"
# GOVPLAT-004: Risk scoring service type issues
disable_error_code = ["attr-defined", "index", "operator"]

[[tool.mypy.overrides]]
module = "src.api.routes.signatures"
# GOVPLAT-004: Signatures route type issues
disable_error_code = ["union-attr", "arg-type"]

[[tool.mypy.overrides]]
module = "src.api.routes.ai_intelligence"
# GOVPLAT-004: AI intelligence route type issues
disable_error_code = ["call-overload"]

[[tool.mypy.overrides]]
module = "src.api.routes.copilot"
# GOVPLAT-004: Copilot route type issues
disable_error_code = ["attr-defined"]

[[tool.mypy.overrides]]
module = "src.api.routes.push_notifications"
# GOVPLAT-004: Push notifications route type issues
disable_error_code = ["assignment", "arg-type", "attr-defined", "return-value"]

[[tool.mypy.overrides]]
module = "src.api.routes.near_miss"
# GOVPLAT-004: Near miss route type issues
disable_error_code = ["attr-defined"]

[[tool.mypy.overrides]]
module = "src.api.routes.form_config"
# GOVPLAT-004: Form config route type issues
disable_error_code = ["call-arg", "arg-type"]

[[tool.mypy.overrides]]
module = "src.api.routes.workflow"
# GOVPLAT-004: Workflow route type issues
disable_error_code = ["arg-type", "attr-defined"]

[[tool.mypy.overrides]]
module = "src.api.routes.rca_tools"
# GOVPLAT-004: RCA tools route type issues
disable_error_code = ["arg-type"]

[[tool.mypy.overrides]]
module = "src.api.routes.policy_acknowledgment"
# GOVPLAT-004: Policy acknowledgment route type issues
disable_error_code = ["arg-type"]

[[tool.mypy.overrides]]
module = "src.api.routes.kri"
# GOVPLAT-004: KRI route type issues
disable_error_code = ["attr-defined", "arg-type"]

[[tool.mypy.overrides]]
module = "src.api.routes.auditor_competence"
# GOVPLAT-004: Auditor competence route type issues
disable_error_code = ["arg-type"]

[[tool.mypy.overrides]]
module = "src.domain.models.capa"
disable_error_code = ["var-annotated"]

[[tool.mypy.overrides]]
module = "src.domain.services.policy_acknowledgment"
disable_error_code = ["return-value"]

[[tool.mypy.overrides]]
module = "src.domain.services.auditor_competence"
disable_error_code = ["assignment", "operator"]

[[tool.mypy.overrides]]
module = "src.api.utils.pagination"
disable_error_code = ["arg-type"]

[[tool.mypy.overrides]]
module = "src.api.utils.entity"
disable_error_code = ["attr-defined"]

[[tool.mypy.overrides]]
module = "src.domain.services.workflow_engine"
disable_error_code = ["assignment", "var-annotated", "arg-type", "operator"]

[[tool.mypy.overrides]]
module = "src.domain.services.risk_scoring"
disable_error_code = ["attr-defined", "index", "operator"]

[[tool.mypy.overrides]]
module = "src.api.routes.audit_trail"
disable_error_code = ["attr-defined"]

[[tool.mypy.overrides]]
module = "src.api.routes.capa"
disable_error_code = ["assignment", "call-overload"]

[tool.pytest.ini_options]
testpaths = ["tests"]
python_files = ["test_*.py"]
python_classes = ["Test*"]
python_functions = ["test_*"]
asyncio_mode = "auto"
addopts = "-v --tb=short"

[tool.coverage.run]
source = ["src"]
omit = ["*/tests/*", "*/__init__.py"]

[tool.coverage.report]
exclude_lines = [
    "pragma: no cover",
    "def __repr__",
    "raise NotImplementedError",
    "if __name__ == .__main__.:",
]
